# ARDSDTCVTR 程式功能規格書

## 1. 基本資料
- **程式名稱**：ARDSDTCVTR
- **程式說明**：ARDSDT類別D，補寫磅單項次
- **程式語言**：RPG/400
- **程式位置**：東鋼/10.10.40.100/QRPGSRC_ARLIB/ARDSDTCVTR.txt
- **開發人員**：S00WCJ
- **建立日期**：103/06/04
- **系統名稱**：應收帳款系統
- **子系統**：折讓單處理
- **備註**：補寫類別為D的ARDSDT檔案中缺少的磅單項次資料
- **聯絡電話**：未指定

## 2. 檔案架構與關聯圖
### 使用檔案：
- **資料庫檔案**
  - ARDSDT：應收帳款折讓單主檔
  - TRNDTLLD：交易明細檔案
- **顯示檔案**
  - 無
- **資料區**
  - 無
- **相關程式**
  - 無

## 3. 檔案欄位規格說明

### ARDSDT（應收帳款折讓單主檔）
| 欄位名稱 | 欄位說明 | 資料類型 | 備註 |
|---------|---------|---------|------|
| ASTXNO | 折讓單號 | 字元 | 主鍵欄位 |
| ASDATE | 折讓日期 | 數字 | 開立日期 |
| ASINNO | 發票號碼 | 字元 | 相關發票號碼 |
| ASPDNM | 產品名稱 | 字元 | 產品代碼 |
| ASQTY1 | 數量 | 數字 | 折讓數量 |
| ASPRC1 | 單價 | 數字 | 折讓單價 |
| ASTXIT | 項次 | 數字 | 磅單項次 |
| ASKIND | 類別 | 字元 | 折讓單類別 |

### TRNDTLLD（交易明細檔案）
| 欄位名稱 | 欄位說明 | 資料類型 | 備註 |
|---------|---------|---------|------|
| TXRESV | 保留欄位 | 字元 | 包含項次資訊 |
| D#TXIT | 項次 | 字元 | 磅單項次 (位於TXRESV 13-14位置) |

### 程式使用資料定義：
| 欄位名稱 | 位置 | 長度 | 型態 | 說明 |
|---------|------|------|------|------|
| P#PRC | - | 1 | 字元 | 處理碼，'Y'表示執行轉換 |
| KEY01 | - | - | KLIST | 存取TRNDTLLD的索引鍵值組合 |

## 4. 輸出/入螢幕布局與說明
此程式無直接畫面輸入/輸出，僅透過參數傳遞進行處理。

### 參數說明
| 參數 | 說明 |
|-----|------|
| P#PRC | 處理碼，'Y'表示執行轉換 |

## 5. 處理流程程序說明

### 主程序流程
1. 程式接收參數P#PRC
2. 檢查處理碼P#PRC是否為'Y'
   - 若不是'Y'，則設定LR指示燈為開，並結束程式
   - 若是'Y'，則繼續執行
3. 檢查ASKIND是否為'D'（指定的類別）
   - 若是'D'，則嘗試使用KEY01從TRNDTLLD檔案中讀取對應資料
   - 若成功讀取（指示燈50為關），則處理資料更新
4. 若找到對應資料，則將TRNDTLLD中的項次資料(D#TXIT)更新到ARDSDT檔案的ASTXIT欄位
5. 更新ARDSDT檔案記錄

## 6. 子程序處理邏輯說明
此程式不包含子程序。

## 7. 錯誤處理程序說明與訊息清冊
此程式無特定的錯誤處理邏輯或訊息，僅透過檔案操作的狀態（如CHAIN指令的結果）進行判斷：
- 指示燈50為開：表示找不到對應的TRNDTLLD記錄
- 指示燈50為關：表示成功找到TRNDTLLD記錄

## 8. 備註

1. 此程式主要用於補寫類別為'D'的ARDSDT檔案中缺少的磅單項次資料。
2. 程式會根據ARDSDT的關鍵欄位，查詢TRNDTLLD檔案取得相應的項次資料。
3. 只有當ASKIND欄位值為'D'時，程式才會進行處理。
4. 此程式不執行任何螢幕輸入/輸出操作，完全透過參數傳遞和檔案操作執行。
5. CHAIN操作使用KEY01索引鍵值組合來查詢TRNDTLLD檔案。
6. 只有在成功找到對應TRNDTLLD記錄時，才會進行ARDSDT檔案的更新。
7. 使用固定格式的RPG/400語法編寫，符合AS/400傳統開發規範。
8. 此程式僅處理特定類別的折讓單資料，是整個折讓單處理流程中的一部分。 