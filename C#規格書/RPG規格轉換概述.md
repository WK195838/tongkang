
# 應收帳款管理系統 – 系統規格書範本

## 1. 專案總覽與目標

本章概述專案背景、範圍及目標，使讀者迅速理解系統定位與發展方向。專案屬於應收帳款管理系統的現代化升級，延續既有 IBM AS/400 RPG 系統功能，新增網頁介面與電子發票整合等功能。主要目標如下：

* \*\*專案背景：\*\*現有應收帳款系統使用 AS/400 (RPG) 平台多年，功能包含應收帳款維護、發票開立與報表產生等。隨著科技演進，企業決定以 ASP.NET MVC 與 React 重建系統，提供更友善的使用者介面和擴充性。
* \*\*專案範圍：\*\*新系統涵蓋應收帳款管理、電子發票查詢列印、報表產生等模組，並與舊有 AS/400 系統平行運作一段時間，確保資料與功能無縫銜接。專案不在範圍內的部分（例如其他財務子系統）由既有系統繼續支援。
* \*\*專案目標：\*\*透過現代化架構提升系統效能與維護性，包括：改善使用者體驗（Web 化介面、即時查詢）、強化與政府電子發票平台整合、縮短報表產出時間，以及確保新舊系統平行期間資料一致與營運不中斷。新系統最終將完全取代舊系統，降低長期營運與維護成本。

## 2. 系統架構說明

本章說明整體技術架構，包含前後端互動方式以及與 AS/400 系統的整合架構。系統採用分層架構，前端為 React SPA（Single Page Application），後端為 ASP.NET MVC（C#.NET）RESTful API 服務，資料儲存於 MS SQL 資料庫。下圖為系統架構圖，展示各組件及其互動關係：

* \*\*前端 (Client)：\*\*使用 React 架構建置的單頁應用程式，透過瀏覽器提供使用者介面。前端與後端以 HTTP/HTTPS API 呼叫進行通信，採用JSON格式傳遞資料。使用者在前端執行應收帳款相關操作（如查詢發票、輸入收款），前端會呼叫對應的後端 API。
* \*\*後端 (Server)：\*\*採用 ASP.NET MVC 架構實作伺服器端應用。後端包含控制器 (Controller)、商業邏輯 (Service) 和資料存取層 (DAL)。控制器接受前端傳來的 API 請求，經商業邏輯處理後，透過資料存取層對 MS SQL 資料庫進行讀寫。後端同時提供傳統 MVC網頁界面（如必要的管理後台）以及 RESTful API 給 React 前端使用。
* \*\*資料庫 (Database)：\*\*使用 Microsoft SQL Server 作為主要資料庫，儲存應收帳款系統的核心資料，如客戶資料、發票與收款記錄、電子發票資訊及報表結果等。資料庫採用標準的正規化設計，確保資料一致性及完整性。
* \*\*與 AS/400 的整合 (Legacy Integration)：\*\*新系統在平行運作期需與舊有 AS/400 系統保持資料同步。透過既有 AS/400 的資料庫介接或中介服務，兩套系統定期交換資料，例如每日晚上以批次作業匯出匯入當日交易，或透過即時 API 呼叫/訊息機制在關鍵操作時同步資料。整合架構圖中以雙向箭頭表示新系統與 AS/400 之間的資料交換機制。為確保資料一致，新舊系統在切換時會執行資料比對，並在平行運作期間維持資料同步。當新系統穩定後，將規劃資料最終移轉及舊系統下線。

*(系統架構圖範例：ASP.NET MVC 後端與 React 前端互動，以及與 AS/400 系統的資料同步流程示意圖)*

## 3. 功能規格

本章依模組說明系統功能需求與規格，包括各功能的描述與流程。主要功能模組如下：

* \*\*應收帳款管理模組：\*\*提供應收帳款從開立到收款的全流程管理。

  * \*發票開立與管理：\*使用者可新增應收帳款發票，填寫客戶、品項、金額等資訊並儲存。系統產生唯一的發票號碼，狀態預設為「未收款」。可支援折讓或作廢發票的處理。發票儲存後，資料寫入新系統資料庫，並可選擇同步至 AS/400 系統以供傳統流程參考。
  * \*收款處理：\*財務人員可記錄客戶付款，對應相關發票號碼進行銷帳。系統允許部分收款並計算剩餘應收餘額。當發票款項全數收訖時，狀態更新為「已收款」。收款資料同步寫入資料庫，必要時傳送至 AS/400 更新其帳款狀態。
  * \*客戶與帳戶維護：\*管理客戶基本資料（名稱、聯絡資訊、信用額度等）以及客戶帳戶的應收帳款餘額。新系統提供介面讓使用者查詢每個客戶的未清帳款及信用狀況。客戶資料可由舊系統匯入並定期同步，確保兩邊資料一致。
  * \*流程圖：\*本模組包含**發票開立與收款流程圖**，描述從新增發票、列印發票、客戶付款到收款登錄的完整流程。透過流程圖說明使用者操作與系統自動處理（例如發票狀態變更、通知觸發）的順序。

* \*\*電子發票查詢與列印模組：\*\*提供電子發票資料查詢、驗證及列印功能。

  * \*電子發票整合：\*新系統與政府電子發票平台（或內部電子發票系統）串接。使用者可依發票號碼、日期區間或客戶查詢電子發票記錄，系統即時從電子發票系統擷取發票明細（例如二維條碼、隨機碼等）。
  * \*發票資料顯示：\*查詢結果以清單呈現，包含發票號碼、開立日期、金額、購買人統編等資訊。點選特定發票可查看詳細內容，如品項清單、稅別、載具號碼等等。
  * \*電子發票列印：\*提供發票列印與匯出功能。使用者可勾選一筆或多筆電子發票進行列印，系統產生符合財政部格式的電子發票紙本版面，供噴墨或雷射印表機列印。亦可匯出PDF檔供電子存檔。列印時系統會將列印次數寫入資料庫備查。
  * \*流程圖：\*包含**電子發票查詢與列印流程圖**，例如使用者輸入查詢條件、系統擷取發票資料、使用者預覽並列印發票的流程。此流程圖有助闡明新系統與外部電子發票服務之間的互動關係。

* \*\*報表產生模組：\*\*負責各類應收帳款相關報表的產生與下載。

  * \*報表清單：\*系統提供多種報表，例如：「應收帳款帳齡分析報表」（按逾期天數統計應收金額）、**「收款明細報表」**（列出期間內每筆收款記錄及對應發票）、**「客戶對帳單」**（顯示特定客戶的期初餘額、本期發票/收款/折讓、期末餘額）。
  * \*參數篩選：\*報表產生前，使用者可透過介面選擇報表類型及設定參數（如日期區間、客戶範圍、部門別等）。系統針對不同報表提供對應的過濾條件，確保輸出內容符合需求。
  * \*即時運算與匯出：\*使用者提交報表請求後，後端即時彙整資料庫中相關資料，產生報表。報表可即時顯示於前端頁面，並提供下載功能（PDF、Excel 等格式）。對於可能運算耗時的報表，系統會有處理進度提示，完成後方可下載。
  * \*報表樣本：\*本文件中提供**報表範例截圖**或範例描述，例如應收帳款帳齡報表的欄位（30天以內、31-60天、61-90天、90天以上的金額統計）及呈現方式，以作為版面設計與內容的參考。

此外，每個功能模組章節均包括對應的**使用案例**或**流程圖**，描述使用者與系統的互動過程，確保功能需求具體且清晰。所有功能需求皆有唯一編號並註明優先級，以利後續追蹤與驗證。

## 4. 資料庫設計

本章提供資料模型設計，包括實體關聯圖(ERD)、主要資料表結構及欄位說明。透過資料庫設計，確保系統資料能夠正確儲存並有效支援各項功能。

* \*\*實體關聯圖 (ERD)：\*\*系統的 ERD 說明各資料實體及其關聯。主要實體包括：

  * \*客戶（Customer）：\*儲存客戶基本資訊。每個客戶可關聯多筆發票。
  * \*發票（Invoice）：\*儲存應收帳款發票主檔，包括發票編號、客戶、日期、金額、狀態（未收款/部分收款/已收款/作廢）等欄位。每張發票屬於一個客戶，可關聯多筆收款記錄。
  * \*收款記錄（Payment）：\*儲存每筆收款資訊，包括收款編號、對應發票、收款日期、金額、收款方式等。一張發票可以對應多筆收款記錄（部分收款情境）。
  * \*電子發票明細（EInvoice）：\*儲存電子發票相關資訊（例如政府平台的發票號碼、隨機碼、QR Code 資料等）以供查詢與列印。可與發票主檔以一對一關係關聯（若每張應收發票對應一張電子發票）。
  * \*使用者（User）：\*儲存系統使用者帳號，用於登入驗證與權限控管，包括使用者姓名、帳號、雜湊密碼、角色等。

* \*\*資料表範例結構：\*\*以下展示主要資料表的欄位結構範例：

  * \*\*Customer（客戶表）：\*\*CustomerID *(int, PK)*、Name *(nvarchar)*、TaxID *(nvarchar, 客戶統編)*、Address *(nvarchar)*、Phone *(nvarchar)*、CreditLimit *(decimal)* 等。
  * \*\*Invoice（發票表）：\*\*InvoiceID *(int, PK)*、InvoiceNo *(nvarchar, 發票號碼)*、CustomerID *(int, FK 至 Customer)*、InvoiceDate *(datetime)*、TotalAmount *(decimal)*、Status *(nvarchar, 發票狀態)*、EInvoiceCode *(nvarchar, 電子發票號碼，如適用)* 等。
  * \*\*Payment（收款表）：\*\*PaymentID *(int, PK)*、InvoiceID *(int, FK 至 Invoice)*、PaymentDate *(datetime)*、Amount *(decimal)*、Method *(nvarchar, 收款方式，如現金/匯款)* 等。
  * *(其餘資料表如 User、EInvoice 等依需求列出)*

  每張資料表均清楚定義主鍵 (PK) 及外鍵 (FK) 關聯，以維護資料的參考完整性。例如 Invoice 表的 CustomerID 為外鍵，關聯到 Customer 表的主鍵；Payment 表的 InvoiceID 關聯到 Invoice 表，確保收款記錄必須對應有效的發票。欄位使用適當的資料型態與長度限制，如金額欄位使用 **decimal(18,2)**，字串欄位按需求長度定義。

* \*\*索引與效能：\*\*針對常用的查詢條件建立索引，例如 Invoice 表的 InvoiceNo、CustomerID 以及 Payment 表的 InvoiceID 等欄位皆建立索引，以加速查詢發票與收款記錄。亦設計複合索引於常用報表查詢（如 Invoice 的客戶+日期），確保在大量資料下系統仍維持良好效能。

* \*\*資料庫正規化與優化：\*\*資料模型遵循第三範式進行正規化設計，避免資料重複與異常。對於特定情境的效能需求，允許適度反正規化或使用檢視 (View)彙總資料。實體關係圖和資料字典詳列於附錄，以供開發人員和DBA 參考。

*(資料庫 ERD 圖：展示 Customer、Invoice、Payment 等資料表及其關聯關係，以圖形方式呈現資料模型設計。)*

## 5. API 規格

本章說明後端提供的 RESTful API 介面清單與規格，包括各 API 的用途、網址路徑、HTTP方法，以及請求與回應的資料格式範例。這些 API 供前端 React 應用程式呼叫，以及未來可能的第三方系統整合。

* \*\*API 設計原則：\*\*遵循 RESTful 設計風格，以資源為中心命名端點，使用適當的HTTP方法（GET查詢、POST新增、PUT/PATCH更新、DELETE刪除）。所有 API 通信採用 JSON 作為資料格式，並使用標準HTTP狀態碼表示成功或錯誤。例如：200 OK（成功）、400 Bad Request（請求參數錯誤）、500 Internal Server Error（伺服器錯誤）等。每個API皆定義輸入參數驗證規則，確保不合法的請求會返回對應的錯誤訊息。

* \*\*API 清單與範例：\*\*下面列出主要功能模組的 API 介面範例：

  * **發票 (Invoices) API：**

    * `GET /api/invoices`：取得所有發票列表，支援查詢參數過濾（例如?customerId=123\&status=unpaid 篩選某客戶未收款發票）。回應為發票清單陣列，含基本資訊如發票號碼、日期、金額、狀態等。
    * `GET /api/invoices/{id}`：取得特定發票詳細資訊。需要路徑參數提供發票ID。回應包含該發票的完整資訊以及相關的客戶資料、收款紀錄列表。
    * `POST /api/invoices`：新增一筆發票資料。請求需提供發票JSON物件（如客戶ID、品項清單、金額等）。成功時回傳新建發票物件及201 Created狀態碼。
    * `PUT /api/invoices/{id}`：更新特定發票資訊（例如修改發票金額或狀態）。部份欄位（如發票號碼）不允許修改。成功時回傳更新後的發票物件。
    * `DELETE /api/invoices/{id}`：刪除特定發票（或標記為作廢）。成功執行則回傳204 No Content。由於財務紀錄不可隨意刪除，此API可能僅允許對錯誤輸入且尚無收款的發票進行作廢標記處理。

  * **收款 (Payments) API：**

    * `GET /api/payments?invoiceId={id}`：取得某發票的所有收款記錄，或不帶參數時取得最近的收款交易列表。
    * `POST /api/payments`：對某發票新增收款記錄。請求JSON包含發票ID、收款金額、日期、方式等欄位。成功時回傳收款記錄物件，並觸發對應發票狀態更新（例如可能部分收款或全額收訖）。
    * *(其他如 GET /api/payments/{id} 取得特定收款詳情、DELETE 作廢收款 等，可視需要提供)*

  * **電子發票 (E-Invoice) API：**

    * `GET /api/einvoices/{invNo}`：依電子發票號碼查詢發票詳細資訊（對應電子發票整合模組）。回傳該電子發票的完整資訊，例如發票號碼、隨機碼、二維條碼資料、開立日期、金額等。如果未查到對應資料，回傳404。
    * `POST /api/einvoices/{invNo}/print`：請求列印指定電子發票。後端記錄列印請求（可能保存列印記錄至DB），並回傳生成的電子發票PDF檔案（以二進位流或URL提供）。

  * **報表 (Reports) API：**

    * `POST /api/reports/aging`：產生應收帳款帳齡分析報表。請求JSON可傳入篩選條件（如截止日期等），後端生成報表資料並儲存報表結果至暫存表或檔案，回傳報表下載連結或ID供日後查詢。
    * `GET /api/reports/aging/{reportId}`：下載先前產生的帳齡報表結果，回傳PDF或Excel檔案。
    * *(其他報表 API 類似處理，如 /reports/receiptDetails 等)*

* \*\*請求/回應範例：\*\*以下以查詢單一發票為例，展示API輸入與輸出格式：

  **範例：取得發票詳細** – `GET /api/invoices/1001`
  **Request:** （無請求體，僅需在URL提供發票ID）
  **Response:** （JSON格式）

  ```json
  {
      "invoiceId": 1001,
      "invoiceNo": "INV-2025-0001",
      "customer": {
          "customerId": 300, 
          "name": "宏佳科技股份有限公司", 
          "taxId": "12345678"
      },
      "invoiceDate": "2025-07-01",
      "totalAmount": 25000,
      "status": "UNPAID",
      "items": [
          { "description": "產品A", "quantity": 10, "unitPrice": 1000, "lineAmount": 10000 },
          { "description": "產品B", "quantity": 5,  "unitPrice": 3000, "lineAmount": 15000 }
      ],
      "payments": [ 
          // 收款紀錄列表，如有則列出
      ],
      "eInvoice": {
          "invoiceCode": "AB-12345678", 
          "randomNumber": "5678",
          "qrCodeData": "(02)AB12345678...(一二維條碼內容)..."
      }
  }
  ```

  此回應範例顯示發票 **INV-2025-0001** 的完整資訊，包括客戶資料、品項清單、當前狀態，以及對應的電子發票資訊（如有）等。

* **錯誤處理與安全性：**所有 API 在輸入驗證失敗時會回傳詳細的錯誤訊息。例如缺少必要欄位將回傳 400 錯誤和說明訊息。未經授權的請求則回傳401或403狀態碼。系統採取適當的身份驗證機制（例如 JWT 或 OAuth2），保護 API 僅供合法用戶存取。同時提供**API 說明文件**（例如Swagger UI），方便開發與測試人員查閱所有可用端點的定義、參數及回應格式。

## 6. UI 設計

本章描述系統使用者介面的設計規格，包括畫面原型、使用者操作流程以及 React 前端的組件架構。透過線框圖和範例介面，展示各主要功能的畫面配置和互動方式，並說明前端模組化的組件設計。

* **設計概覽：**新系統採用響應式Web設計，以確保在不同解析度裝置（桌機、筆電）上皆有良好使用體驗。介面風格遵循公司CI，色系與字型一致。功能操作流程強調簡潔直觀，例如以清楚的菜單導覽至各模組（應收帳款、電子發票、報表、系統管理等）。本章提供**主要畫面的線框圖**與**操作流程圖**，以利後續UI製作。

* \*\*主要介面原型：\*\*以下列出幾個核心畫面及其要點：

  * \*登入頁面：\*使用者輸入帳號密碼進行登入。提供公司Logo和系統名稱，簡潔的欄位與登入按鈕。支援基本驗證反饋（如帳密錯誤提示）。登入成功後導向系統主頁。
  * \*系統主頁 (Dashboard)：\*登入後的首頁，顯示關鍵資訊摘要及快速連結。例如待收帳款總額、逾期發票數量等的圖表摘要，常用功能捷徑按鈕（「新增發票」「查詢發票」「收款登錄」等）。此頁提供財務人員即時掌握應收狀況的概況。
  * \*發票列表頁：\*列出所有發票記錄的清單頁面。提供篩選與搜尋功能（依客戶、日期範圍、狀態等）。清單以表格呈現欄位：發票號碼、客戶名稱、日期、金額、狀態、操作（檢視/編輯/列印）。使用者可點選發票號碼以查看詳情，或點擊「收款」直接跳轉到收款登錄對應畫面。清單支援分頁及排序，確保在大量資料時仍易於瀏覽。
  * \*發票詳情/編輯頁：\*顯示單一發票的詳細資料，分區呈現基本資訊（發票號碼、客戶、日期、總金額、狀態）、品項明細（表格列出品名、數量、單價、小計）、收款紀錄（如有則列表顯示金額和日期）以及電子發票資訊。頁面提供編輯功能（僅限特定欄位，如發票備註），以及操作按鈕例如「列印發票」、「新增收款」、「作廢發票」。若點擊「新增收款」，跳出收款記錄的表單對話框。此頁透過清晰的版面讓使用者一次掌握該發票的所有相關資訊。
  * \*電子發票查詢頁：\*提供查詢介面讓使用者輸入條件（發票號碼或日期區間）以搜尋電子發票。查詢結果以卡片或列表方式呈現每筆電子發票摘要，點擊可展開更多細節（例如載具類型、二維條碼圖示）。每筆結果旁提供「列印」按鈕，點擊後產生電子發票PDF檔案供下載或直接列印。
  * \*報表產生頁：\*使用者可選擇報表類型並填入參數（如選擇「帳齡分析報表」並指定截止日期）。點擊「產生報表」後，前端呼叫後端API開始生成。畫面上顯示處理進度指示，完成後出現「下載報表」連結。報表參數表單設計友好，包含日期選擇器、下拉選單等元件，減少輸入錯誤。
  * \*系統管理頁面：\*僅系統管理員可見，用於管理使用者帳戶與權限。包含使用者清單（帳號、姓名、角色、狀態）以及編輯/停用按鈕，還有角色權限設定介面等。此部分UI需與權限模組緊密結合，確保一般用戶無法存取。

* **互動流程範例：**以**發票開立與收款流程**為例：

  1. 使用者在「新增發票」頁面填寫發票資料並提交。前端進行基本欄位驗證（如必填欄位、數值格式）。
  2. 提交後，React 前端呼叫 `POST /api/invoices` API，顯示等待提示。後端成功返回發票資料後，前端導向發票詳情頁並顯示「發票新增成功」訊息。
  3. 使用者在發票詳情頁點選「列印發票」按鈕，前端呼叫對應API取得發票PDF並觸發瀏覽器列印對話框。
  4. 客戶付款後，使用者在該發票詳情頁點擊「新增收款」，彈出收款表單輸入收款金額與日期。提交後前端呼叫 `POST /api/payments` API，成功則更新頁面中的收款紀錄列表及發票狀態（例如改為部分收款或已收款），同時提示「收款登錄成功」。
     此流程中的每一步操作在前端都有明確的狀態反饋，如載入指示、成功或錯誤訊息，確保使用者了解系統正在處理或已完成動作。

* \*\*React 組件架構：\*\*前端專案以模組化方式構建，將UI拆分為可重用的React組件。採用單頁應用 (SPA) 架構，利用 React Router 實現不同功能頁面的路由。主要的組件架構包括：

  * \*頁面級組件 (Pages)：\*對應上述主要介面的高階組件，如 `<InvoiceListPage>`, `<InvoiceDetailPage>`, `<PaymentFormModal>` 等，負責調用後端API並管理頁面狀態。
  * \*容器與展示組件：\*容器組件（Container）負責管理資料狀態與與後端溝通，例如 `<InvoiceListContainer>` 從API取得資料後透過屬性傳給子組件。展示組件（Presentational）只負責根據傳入props渲染UI，例如 `<InvoiceTable>` 接收發票清單資料並渲染表格。這種模式方便維護和測試。
  * \*共用元件 (Components)：\*一些可在多處重用的基礎元件，例如 `<DataTable>`, `<FilterBar>`, `<DatePicker>`, `<Modal>` 等，提高一致性和降低重複開發。
  * \*狀態管理：\*針對全域狀態（如登入使用者資訊、通知訊息），採用 React Context 或狀態管理庫 (例如 Redux) 來管理，使各組件能方便取得狀態或派發事件。局部UI狀態則運用 React Hooks (如 `useState`, `useEffect`) 在組件內處理。
  * \*樣式與布局：\*使用 CSS 預處理器或 CSS-in-JS 進行樣式管理，遵循響應式設計原則。統一定義元件的樣式風格，包括色彩、字體、間距等，保證整體介面的一致性。

* \*\*無障礙與易用性考量：\*\*UI 設計遵循易用性原則，例如按鈕和連結具有清楚的文字標示，重要操作需要確認對話框避免誤觸。整體配色考慮對比度，以符合無障礙等級。表單元件有清楚的錯誤提示訊息位置和說明文字。鍵盤操作也可完成主要任務（例如使用Tab鍵導航表單）。

本章所附的**畫面原型圖**提供視覺參考，**互動流程圖**確保前後端對接順暢。在實作UI時，會根據這些設計範本進一步細化，並持續與使用者驗收反饋做調整。

## 7. 權限與身分管理

本章定義系統的使用者角色、權限控制機制以及管理方式，以確保系統安全性和資料存取的恰當性。透過**角色與權限矩陣**來明確每種角色的職責與可執行操作。

* \*\*身分驗證 (Authentication)：\*\*系統使用帳號/密碼進行登入驗證，每位使用者在系統資料庫的 User 表中有一筆帳戶記錄（包含登入帳號、雜湊後的密碼、姓名、電子郵件、角色等資訊）。登入流程遵循安全要點，例如密碼保存採用強雜湊算法，連線採HTTPS避免攔截。使用者登入成功後，系統發行身份憑證（如 JWT Token 或 Session Cookie），後續每次API請求都需附帶憑證以驗證身份。若憑證無效或過期，API 將回傳401要求重新登入。

* \*\*授權與存取控制 (Authorization)：\*\*系統按照角色(Role-Based Access Control, RBAC)進行權限管理，不同角色對系統功能有不同的可存取範圍。主要預定義的角色與其權限範圍如下：

  * \*\*系統管理員 (Administrator)：\*\*最高權限角色。可以存取系統所有模組與功能。例如：管理使用者帳戶（新增/刪除/修改其他使用者、重置密碼）、調整角色權限設定、查看所有報表、設定系統參數等。管理員通常由IT單位指派。
  * \*\*財務經理 (Finance Manager)：\*\*應收帳款部門主管角色。可檢視及操作應收帳款模組的所有功能，包括發票開立、編輯、收款登錄、發票作廢等；能查詢並列印所有電子發票；可產生所有報表。另有權限審核特殊交易（如大額沖銷、呆帳處理）。
  * \*\*財務專員 (Accountant/User)：\*\*一般應收帳款人員角色。可執行日常業務操作：新增發票、查詢及編輯所屬客戶的發票、登錄收款；可查詢電子發票並列印給客戶；可產生常規報表。不可進行高階管理操作（例如無權新增使用者或變更他人發票）。
  * \*\*查詢/稽核 (Auditor/Viewer)：\*\*只讀角色。通常供內部稽核或管理階層查詢使用。擁有查詢所有資料的權限，包括查看發票與收款細節、電子發票內容和報表，但無法對任何資料進行新增、修改或刪除操作。

* \*\*權限矩陣：\*\*下表概述各角色對主要功能的權限矩陣（✓ 表示允許執行）：

  | 功能/模組     |   系統管理員  | 財務經理 |     財務專員    |  稽核查詢  |
  | --------- | :------: | :--: | :---------: | :----: |
  | 使用者管理     | ✓ (管理帳號) |   –  |      –      |    –   |
  | 客戶資料維護    |     ✓    |   ✓  |      ✓      | ✓ (唯讀) |
  | 發票開立與編輯   |     ✓    |   ✓  |      ✓      | ✓ (唯讀) |
  | 發票作廢/沖銷   |     ✓    |   ✓  | – *(可能僅檢視)* | ✓ (唯讀) |
  | 收款登錄      |     ✓    |   ✓  |      ✓      | ✓ (唯讀) |
  | 電子發票查詢/列印 |     ✓    |   ✓  |      ✓      | ✓ (唯讀) |
  | 報表產生      |     ✓    |   ✓  |      ✓      | ✓ (唯讀) |
  | 系統參數設定    |     ✓    |   –  |      –      |    –   |

  *註：實際權限定義視企業政策可微調，例如財務專員或許可執行小額沖銷等。*

* \*\*權限檢查機制：\*\*後端在每個API端點實作授權檢查。例如當財務專員嘗試調用使用者管理相關API時，系統將回傳403 Forbidden拒絕。前端也會據角色隱藏不具權限的UI元素（例如一般使用者登入後不顯示「使用者管理」選單）。權限規則集中定義，便於維護。例如使用 ASP.NET 的授權屬性 (`[Authorize(Roles="Admin,Manager")]`) 或自訂權限檢查中介軟體，以確保關鍵操作只能被授權角色執行。

* \*\*角色與權限管理介面：\*\*系統提供圖形介面讓管理員管理角色與使用者。管理員可在「使用者管理」頁面編輯某使用者的角色，或者設定角色擁有的權限模組（若採更細緻的ACL控制）。此設定介面呈現出角色與權限矩陣，讓管理員勾選或取消勾選對應權限。更新後，系統即時套用新的權限配置。

* \*\*稽核記錄 (Audit Trail)：\*\*為強化安全與追蹤，系統對重要操作及權限變更保留稽核記錄。例如：使用者登入失敗/成功紀錄、增刪發票與收款的時間與操作者、角色權限變更歷程等。這些資訊儲存在Log或專門的Audit資料表中，以備日後稽核查詢。

透過以上機制，系統能確保「該看的人看得到，該做的人做得到」，未授權的存取將被防範，維持系統運作的**清晰、高效且安全**。

## 8. 系統整合規劃（與 AS/400 的資料同步）

本章說明新舊系統平行運作期間的整合策略，包括資料同步範圍、方式及訊息交換機制，確保在過渡期內兩套系統資料一致，並將對使用者的影響降到最低。

* **平行運作概述：**在新系統上線初期，將與現有 AS/400 應收帳款系統平行運作一段時間（例如3個月），以驗證新系統穩定性和功能正確性。平行期間，兩套系統會**同時運作**，使用者可繼續在舊系統進行日常操作，同時逐步在新系統上執行相同作業。此策略優點是：若新系統發生問題，隨時可由舊系統支援，降低切換風險；使用者也有充裕時間適應新介面。

* \*\*資料同步範圍：\*\*確定需要同步的資料項目和方向。典型同步範圍包括：

  * \*主檔資料：\*如客戶主檔、產品/服務清單等主資料，由於這類資料在兩系統都會使用，需保持一致。可以每天由舊系統匯出最新主檔資料並匯入新系統，或在新系統變更主檔時即寫回舊系統。
  * \*交易資料：\*如發票、收款等應收帳款交易，需要雙向同步。例：在舊系統新增的發票，也寫入新系統資料庫；在新系統記錄的一筆收款，也更新回舊系統。同步範圍亦包含電子發票開立狀態（若舊系統無該功能可排除）。
  * \*報表與歷史資料：\*報表通常由新系統自行計算，但基礎資料同步後兩邊結果應一致。歷史舊資料可以在上線前一次性遷移大部分到新系統；平行期間產生的新交易資料按日同步。

* **資料同步方式：**根據資料即時性要求，採取**批次同步**為主、即時同步為輔的混合策略：

  * \*批次同步：\*設定每日定時批次工作，在非營業時間（如每日夜間）執行。由舊系統抽取當天新增或變動的資料（例如新發票、收款），透過中間檔案（如CSV）或資料庫連線傳輸至新系統；反之亦然，由新系統匯出當日輸入的資料導入舊系統。批次作業完成後產生報告，列出同步筆數及異常，以供隔日人工確認。
  * \*即時同步：\*對於關鍵操作，考慮即時同步以降低兩系統資料差異。例如在新系統完成「收款登錄」時，透過後端程式即時呼叫 AS/400 提供的 API 或以消息(queue)通知方式，將該收款寫入舊系統；或當舊系統錄入一筆調帳時，即時通知新系統更新。即時同步可透過 Web Service、Message Queue (如IBM MQ)、資料庫觸發器等技術實現，確保關鍵資料即時一致，但須評估對舊系統之影響和可行性。
  * \*同步衝突處理：\*制定規則避免雙重輸入造成衝突。可將某些資料指定以一方系統為主。例如規定平行期間**發票新增**僅在新系統操作（舊系統照常接收同步），**收款登錄**則雙邊都可，但以舊系統為主輸入來源，新系統負責接收。如果同一筆資料在兩端不小心重複輸入，新系統批次同步時將偵測重複並記錄警示，由管理員手動比對處理。

* \*\*訊息交換與介接：\*\*新舊系統透過既有介面或中介軟體交換資料：

  * \*資料庫層直連：\*透過ODBC/JDBC連線，讓新系統直接讀取AS/400上的DB2資料庫特定檔案 (Files)；或相反在AS/400上配置ODBC資料源讀取 SQL Server。此方式快速但需注意異質資料庫的資料類型對應與權限控制。
  * \*Web API/Web Service：\*開發REST API或SOAP Web Service供對方系統調用。例如在AS/400上建立提供發票/收款查詢的Web Service，新系統批次程式可在同步時呼叫取得資料。新系統也可提供API供舊系統（若具備Web調用能力）在資料變動時呼叫。API交換可在應用層實施驗證與資料轉換，較安全彈性。
  * \*中介檔案或訊息隊列：\*利用中介檔案（如每日匯出CSV、XML檔），由對方系統定時匯入；或者使用訊息佇列技術（如 IBM MQ, RabbitMQ），在新系統有事件時發布訊息至佇列，由舊系統訂閱接收更新。這些方式可減少系統直接耦合，但需要處理錯誤重送與順序控制。

* \*\*同步稽核與監控：\*\*實施同步機制時，加入稽核與監控措施：

  * 每次批次同步產生日誌(Log)記錄成功與失敗的資料項目數量，若發生錯誤（例如某筆資料格式不符、對方系統連線失敗），則記錄詳細資訊並發送告警通知相關人員（如email或監控系統告警）。
  * 新系統介面提供**同步監控儀表板**，顯示最近同步狀態、錯誤摘要以及資料差異報表。管理員可依此判斷平行期間雙方資料是否一致。
  * 定期執行資料對帳，例如每週對比新舊系統的關鍵總額（如總應收帳款餘額、未收款發票數量）以確認偏差是否在允許範圍。

* \*\*使用者操作與培訓：\*\*平行運作期間，針對使用者在兩套系統的操作制定明確指引。可能的策略是分批導入：第一週先讓部分用戶試用新系統，其他用戶繼續在舊系統操作，逐步增加新系統使用比例。提供培訓課程和操作手冊，讓使用者熟悉新系統流程。加強溝通管道，收集使用者反饋並快速改進。

* \*\*最終切換與資料移轉：\*\*在平行運作接近尾聲時評估新系統表現，確認關鍵功能穩定且使用者已適應。規劃正式切換的時間點（如月末或季末），提前公告用戶。屆時將：

  * 暫停系統服務一段時間作最終資料匯入（Freeze period），確保無交易遺漏。
  * 執行最後一次完整資料同步/遷移，尤其是平行期間新增的所有資料自舊系統移入新系統，並驗證完整性。
  * 切換DNS或更新系統入口，讓使用者全面轉至新系統操作。舊系統改為唯讀備查狀態或下線關閉。
  * 切換後緊密監控新系統運作，如遇緊急問題，可啟動備援方案（短期內讓舊系統重新提供服務）。若一切正常，正式宣告新系統上線完成。

透過周全的整合與平行運作規劃，新舊系統切換將**降低風險並平穩過渡**。本章提供的整合架構圖與同步流程說明，做為技術團隊執行資料同步開發與作業參考。

## 9. 開發與部署環境說明

本章列出系統的技術堆疊、開發工具、環境配置與部署流程，確保團隊有一致的開發環境並規範部署方式。

* **技術堆疊 (Tech Stack)：**

  * \*後端：\*Microsoft ASP.NET MVC 平台（預計使用 .NET 6 或以上版本的 ASP.NET Core）。語言為 C#.NET。使用ORM技術（例如 Entity Framework Core）與 MS SQL 資料庫溝通。關鍵第三方套件包括：日誌紀錄 (如 Serilog/NLog)、API 文件產生 (Swashbuckle/Swagger) 等，以提升開發效率。
  * \*前端：\*React 18.x 框架，語言使用 TypeScript 以增強型別安全。搭配 UI 元件庫 (例如 Ant Design 或 Material-UI) 以加速常用介面元件的開發。構建工具使用 Webpack 或 Vite，提供模組打包與開發時即時重載功能。
  * \*資料庫：\*Microsoft SQL Server 2019 或以上版本。使用者身分與密碼等敏感資料採用加密/雜湊技術儲存。
  * \*其他：\*版本控制採用 Git；持續整合/部署 (CI/CD) 工具例如 Azure DevOps Pipelines 或 Jenkins；Issue 追蹤與專案管理使用 Azure Boards 或 Jira。

* \*\*開發環境：\*\*開發人員使用統一的環境配置：

  * 作業系統：Windows 10/11 (後端開發) 及可選用 macOS/Linux (前端開發)。
  * 開發工具：後端使用 Visual Studio 2022 或 Visual Studio Code；前端主要使用 Visual Studio Code 搭配 Node.js (v16+) 環境。團隊制定程式碼風格指南與Lint設定（ESLint for JS/TS, StyleCop或Resharper for C#），確保程式碼品質與一致性。
  * 專案結構：採用Mono-repo或分離前後端Repo均可。如果Mono-repo，則專案目錄下區分 `/frontend` 和 `/backend` 資料夾。前端使用`npm/Yarn`管理套件，後端使用NuGet。開發時前後端可各自啟動（React開發伺服器+後端本機IIS Express或Kestrel），透過設定跨來源(CORS)政策允許本機開發互通。

* \*\*測試環境：\*\*配置獨立的測試/整合環境：

  * 架設一套與正式環境類似的測試伺服器（ASP.NET API 服務及React前端部署）以及測試用的 SQL 資料庫。數據可每日從正式資料庫截斷取樣或匿名化後導入，用於系統測試。
  * 若AS/400有測試機，串接新系統測試環境，以驗證整合流程；若無則模擬相關介面返回。
  * 測試環境的設定（Connection strings、API URL等）與正式環境隔離，儲存在組態檔或環境變數中。

* \*\*正式生產環境：\*\*預計部署於公司內部資料中心或私有雲：

  * 伺服器：Windows Server 2019 (或以上) 作業系統。部署 IIS 用於承載 ASP.NET 應用，設定適當的 Application Pool；前端 React 應用建置後產出靜態檔案（HTML/CSS/JS）也由 IIS 提供靜態內容。
  * 硬體資源：規劃2台應用伺服器 (Web Server) 負載平衡提高可用性；1台資料庫伺服器運行 MS SQL（或使用既有SQL叢集）。視使用量評估規模，預留垂直擴充空間（如增加CPU/RAM）。
  * 網絡與安全：部署環境位於內網區域，透過防火牆限制存取。配置HTTPS憑證供Web站台使用，確保資料傳輸加密。資料庫與應用伺服器間在內網通訊，必要時使用不同網段並設防火牆ACL。

* \*\*部署流程：\*\*制定標準的部署作業流程，可能包含自動化步驟：

  1. \*\*建置 (Build)：\*\*開發完成一輪功能或修正後，由CI工具觸發建置流程。在乾淨的環境執行後端專案的編譯（`dotnet build`）與單元測試（`dotnet test`），以及前端專案的編譯（`npm run build`產生靜態檔）。CI若發現編譯或測試失敗則中止部署。
  2. \*\*套件/發行 (Package/Release)：\*\*後端產生可部署檔案（例如 .zip 或 .dll 集合，或容器映像），前端產出build目錄內容。CI將這些 Artefacts 上傳至制品庫。對於容器化部署，可在此步驟建立Docker映像並推送至映像倉庫。
  3. \*\*部署 (Deploy)：\*\*經過負責人審核，批准發行到特定環境（測試或正式）。CD流程連線到目標伺服器執行部署腳本：後端部分將先前打包的檔案部署至IIS站台（或拉取更新Docker容器），前端則將新的靜態檔案發布到Web目錄。部署腳本也會處理資料庫 Migration（如果Schema有變更，執行資料庫更新腳本或Code-First Migration），以及相關組態（如更新appsettings檔案設定正確的連線字串、API URL）。
  4. \*\*驗證與切換：\*\*部署完成後，在測試環境自動執行Smoke Test確認服務正常啟動、核心API可回應。正式環境部署採零停機策略，使用藍綠部署或逐台滾動更新：例如先將一台Web伺服器設定為維護模式，更新完成驗證後再切換流量，接著更新下一台，以確保系統持續可用。

* **版本控管與組態：**透過版本控制系統 (Git) 管理程式碼，使用**Git分支策略**來支援多人協作和穩定交付：

  * 主要分支包括 `main` (或 `master`) 分支保存穩定的生產代碼，`develop` 分支用於集成最新開發變更。新功能或修正以分支方式開發 (`feature/` 或 `bugfix/` 前綴)，完成後經過Pull Request程式碼審查合併至 develop。
  * 當要發布新版本時，從 develop 分支建立 `release/x.y` 分支進行最後測試與調整，確認無誤後合併至 main 分支並打上標籤(Tag)標記版本號（如v1.0.0）。CI系統監控 main 分支tag，一旦有新Tag即自動部署對應版本到正式環境。
  * 緊急修正採用 Hotfix 分支從 main 拉出修補，再合回 main 和 develop，確保所有分支同步修復。

* **版本號與發布節奏：**遵循**語意化版本** (Semantic Versioning) 規範：版本格式為 `主版本.次版本.修訂版` (例如1.0.0)。主版本大幅變更、次版本新增功能向下相容、修訂版為小幅修改或補丁。計劃初次上線為 v1.0.0，之後依功能開發節奏發布 v1.1.0, v1.2.0,... 等等，一旦平行運作結束並全數上線，可標記為 v2.0.0。版本號將顯示於系統關於頁，方便用戶與開發團隊確認所使用版本。

* \*\*環境組態管理：\*\*對不同環境（開發/測試/正式）使用獨立的組態檔案或環境變數，儲存如資料庫連線、API根URL等配置。避免將機密直接寫入程式碼庫，例如採用Azure Key Vault或環境變數注入方式提供密鑰。前後端應具備可調整組態的機制（如appsettings.\*.json，React專案的環境變數`.env`檔），以確保在各環境切換時不需修改程式碼。

透過上述**開發環境**與**部署流程**的規範，團隊能更有效地協作開發並平順地將新系統部署到各環境。此章節提供的資訊確保所有成員了解技術架構與工具鏈，並遵循既定程序發佈高品質的軟體產品。

## 10. 測試規格

本章定義系統測試策略，包括測試種類、範圍與範例測試案例，確保系統符合需求並保持高品質。透過完善的測試計畫，在上線前發現並修正問題，同時驗證平行運作期間新舊系統結果一致。

* \*\*測試策略與類型：\*\*系統測試將涵蓋多層次：

  * \*單元測試 (Unit Testing)：\*針對後端C#方法和前端JavaScript函式撰寫單元測試。使用後端 xUnit/NUnit 框架驗證關鍵商業邏輯（例如發票金額計算、逾期天數演算），前端使用Jest進行元件邏輯測試。單元測試覆蓋率目標設定為例如80%，確保大多數核心函式都有覆蓋。
  * \*整合測試 (Integration Testing)：\*測試模組之間及與外部系統的互動。在測試環境部署完整系統，使用測試帳戶執行端對端案例。例如新系統調用AS/400介面的流程，在測試環境以模擬或連接測試AS/400驗證資料交換正確性。整合測試包含資料庫操作驗證（ORM正確寫入讀出）以及API串接行為。
  * \*UI/功能測試 (Functional Testing)：\*由測試人員依據需求規格進行手動操作測試，或撰寫自動化UI測試腳本（Selenium、Playwright 等）來模擬使用者操作。驗證每個使用者故事/功能是否按照規格實現，包括正常流程和異常處理。例如：建立發票->收款->報表各步驟是否正確工作。
  * \*性能測試 (Performance Testing)：\*對關鍵API和功能進行負載與壓力測試。使用 JMeter或Locust 模擬多使用者同時查詢發票或產生報表，以評估系統在高負載時的響應時間和資源消耗。制定性能基準（如同時100人查詢時，平均響應時間<3秒）並測試是否達標。
  * \*安全測試 (Security Testing)：\*檢視系統是否存在常見漏洞。包含滲透測試(Penetration Test)與程式碼安全掃描（例如OWASP ZAP掃描 Web漏洞）。測試內容如：確保未經授權無法存取API、SQL Injection防禦、生密碼不得明文存儲等。
  * \*使用者驗收測試 (UAT)：\*邀請最終使用者（財務人員）參與，使用接近真實資料與情境操作新系統，確認新系統功能及介面符合業務需求且友善易用。UAT期間收集使用者反饋，作為最終調整依據。

* \*\*測試案例 (Test Cases)：\*\*為關鍵功能設計詳細的測試案例。每個測試案例文件包含測試編號、測試項目、前置條件、測試步驟、預期結果等欄位。以下舉例數個測試案例：

  * **測試案例1：發票開立與資料庫驗證**
    \*\*前置條件：\*\*使用者已登入新系統；有一筆存在的客戶資料（如客戶ID=300）。AS/400 系統測試資料庫中對應也有該客戶。
    **步驟：**

    1. 在「新增發票」畫面輸入客戶=300、發票品項2筆（品名A 5件 單價1000；品名B 3件 單價2000），點擊提交。
    2. 系統返回發票新增成功，取得新發票號碼（如INV-2025-0005）。
    3. 打開資料庫，確認 Invoice 資料表中出現編號為INV-2025-0005的記錄，總金額正確為 *5*1000 + *3*2000 = 11000。Invoice狀態為`UNPAID`。
    4. 在AS/400測試環境查詢該客戶最近發票，確認也同步新增了這筆發票記錄，金額與狀態一致。
       **預期結果：**

    * 前端提示發票新增成功，新發票詳情正確顯示輸入的品項和金額合計。
    * 新系統資料庫成功寫入發票主檔及明細，資料正確無誤。
    * 舊AS/400系統收到同步的發票資料，與新系統內容匹配。
    * 無錯誤日誌。如有同步失敗，系統會記錄錯誤並告警（不過本案例預期成功）。

  * **測試案例2：收款登錄流程**
    \*\*前置條件：\*\*存在一筆「未收款」狀態的發票INV-2025-0005（金額11000，如上案例建立），使用者具有收款權限。
    **步驟：**

    1. 使用者開啟INV-2025-0005發票詳情頁，點擊「新增收款」。填寫收款金額6000、日期為今日、方式=匯款，確定提交。
    2. 系統返回收款登錄成功，發票詳情頁更新：收款列表出現該筆6000記錄，發票狀態從`UNPAID`變為`PARTIAL PAID`（部分收款），剩餘金額5000顯示。
    3. 使用者再次點擊「新增收款」，填寫金額5000、日期為今日、方式=匯款，提交。
    4. 系統返回成功，發票狀態更新為`PAID`（已收款），收款列表共有兩筆記錄（6000與5000），總計11000。
    5. 檢查資料庫 Payment 表，應出現兩筆對應該發票的收款資料，金額吻合，Invoice表該筆發票狀態更新為已收款。
    6. 確認AS/400系統中該發票狀態亦更新為已收款，並有對應兩筆收款紀錄。
       \*\*預期結果：\*\*發票可正確分次收款，狀態與金額即時更新，前端介面顯示正確，後端資料庫與舊系統同步均正確。

  * **測試案例3：權限控制與UI顯示**
    \*\*前置條件：\*\*建立兩個測試帳號：user\_A 角色為財務專員，user\_B 角色為稽核查詢。
    **步驟與驗證：**

    * 以 user\_A 登入，應看到「發票管理」「收款登錄」「電子發票」「報表」等功能選單，但**不**應看到「使用者管理」。嘗試直接存取管理員路由URL，系統應顯示存取被拒絕。user\_A 可正常執行發票新增、收款等操作。
    * 以 user\_B 登入，只看到查詢類功能（如報表查詢），操作介面上所有輸入框應為唯讀或無編輯按鈕。嘗試調用後端修改API（如直接透過工具對某發票發送DELETE請求），應獲得403 Forbidden響應。
      \*\*預期結果：\*\*系統能依角色正確限制功能。不同角色登入時UI元素和可執行操作有所區隔，未授權的操作均被攔截，符合權限矩陣設計。

  *(更多測試案例針對每項功能撰寫，例如電子發票查詢錯誤情境：輸入不存在的發票號碼應提示「查無資料」；報表產生性能測試：1000筆發票資料情況下生成報表耗時在預期範圍內等。)*

* \*\*測試資源與日程：\*\*由測試團隊制定測試計畫表，安排單元測試、整合測試在開發過程中持續進行，功能完成後進行功能測試，最後由業務單位進行UAT。關鍵里程包含：

  * 單元測試：開發過程中持續進行，每日Build自動跑所有單元測試。
  * 整合測試：在系統測試環境搭建完成後進行，預計耗時2週涵蓋主要流程。
  * 性能與安全測試：在上線前1個月進行專項測試與調優。
  * UAT：平行運作開始前2週邀請終端使用者進行驗收測試，收集問題清單並修正。

* \*\*測試報告：\*\*每輪測試結束後產出測試報告，包含測試案例執行結果摘要、發現的缺陷列表及嚴重程度。測試報告將提交專案經理和相關干係人，以決定是否進入下一階段或上線。所有缺陷須經過重測驗證確定解決後，才能標記測試通過。

透過以上多層次的測試規格與案例範例，可確保新系統在功能正確性、效能、安全性等各方面都滿足專案需求。測試是平行運作成功與否的關鍵支柱之一，完整的測試計畫將大幅降低上線風險。

## 11. 維運規劃

本章描述系統上線後的維護與運行計畫，包括備份策略、系統監控、故障處理和日常維運流程，確保系統長期穩定運行並降低營運風險。

* \*\*備份策略 (Backup Strategy)：\*\*制定嚴謹的資料備份方案保護關鍵資料：

  * \*資料庫備份：\*對 MS SQL 資料庫執行定期備份。建議每日夜間進行差異備份、每週進行完整備份，保留最近一週的每日備份與最近三個月的週備份。備份檔案儲存在異地伺服器或可靠的網路存儲，以防單一機房故障。定期測試備份還原，確保備份檔有效可用。
  * \*檔案備份：\*如果系統有產生檔案（例如電子發票PDF存檔、報表輸出檔），定期將檔案目錄備份到備援儲存。對於用戶上傳的附件等資料亦需納入備份考量。
  * \*原始碼與組態備份：\*程式碼倉庫已由Git集中管理並在雲端有備份；部署環境的重要組態（IIS設定、環境變數等）文件化並安全儲存，方便緊急重建系統。

* \*\*系統監控 (Monitoring)：\*\*導入監控工具即時掌握系統健康狀況：

  * \*應用監控：\*使用應用性能管理(APM)工具（如 Application Insights、New Relic）監控後端API的請求量、平均響應時間、失敗率等指標。一旦某API錯誤率或延遲超過預設閾值，自動發送警報給維運人員。
  * \*伺服器監控：\*透過監控系統(Nagios、Zabbix等)檢測伺服器CPU、記憶體、磁碟使用率，以及IIS服務狀態、網路連線數等。當資源接近瓶頸或服務異常停止時，立即通知管理員採取行動。
  * \*日誌管理：\*集中收集應用日誌與錯誤訊息。例如配置Serilog將ASP.NET例外錯誤寫入檔案並串接Splunk/ELK等日誌分析系統。前端也可蒐集錯誤訊息（如React runtime error）傳回後端記錄。維運人員定期檢視日誌，主動發現隱患。
  * \*使用量監控：\*觀察系統使用情形，如每日登入人數、操作量、關鍵交易筆數等，作為未來擴充系統容量的參考。如果發現某些報表查詢頻繁導致效能下降，可考慮優化或增設快取。

* \*\*錯誤處理與支援流程：\*\*建立明確的故障處理SOP和支援機制：

  * \*等級分類：\*將可能故障事件按嚴重性分級，如P1(嚴重：系統停擺或核心功能無法使用)、P2(中等：部分功能受限但有替代方案)、P3(一般：非關鍵問題或使用者疑問)。
  * \*通報與響應：\*指定故障通報管道，例如用戶發現問題可透過內部IT服務台提交工單或撥打專線。維運團隊在工作時間內需於多少時間內回應（如P1級15分鐘內回應，2小時內解決/緩解）。非工作時間若有P1緊急事件，安排On-call人員接收警報並及時處理。
  * \*問題排查：\*接獲通報後，維運團隊根據日誌、監控資訊展開調查。若為應用Bug，通知開發團隊緊急修復並制定Hotfix發布；若為環境問題（硬體故障、網路中斷），聯繫相關基礎架構人員協助。
  * \*暫時措施：\*對於需要較長時間修復的問題，提供臨時解決方案減少使用者影響。例如新系統發票列印功能故障時，指導使用者先從舊系統列印；或資料同步不及時時，手動比對關鍵資料補正。
  * \*問題追蹤：\*每個事件在解決後記錄於故障追蹤報告，包括發生時間、影響範圍、根本原因(RCA)、解決方法和預防措施。定期彙整問題類型，持續改進系統穩定度。

* \*\*維護窗口與版本更新：\*\*計劃定期的系統維護時段，以應用更新和進行維護工作：

  * \*維護窗口：\*與業務單位協調設定定期維護時段（例如每月第二個週六晚間），在此期間可暫停系統提供服務進行升級、資料庫維護等。維護前以公告方式提前通知使用者。對於小幅更新，可嘗試零停機部署，上述維護窗主要留作重大更新或資料庫變更使用。
  * \*版本更新流程：\*新功能或修正累積到一定程度，即發布新版本。更新前QA環境完整測試，安排在非尖峰時段發布。版本更新時，遵循部署流程逐步進行並觀察系統狀況，遇問題立即停止/回滾至前版本。版本發布後更新系統說明文件和使用者操作指南，讓使用者了解變更內容。

* \*\*資料維護與清理：\*\*長期運行中，資料庫資料量會成長，需要計劃清理與優化：

  * 定期清理暫存或日志資料表，例如超過半年之執行歷程日志可歸檔或刪除，保持資料庫精簡。
  * 對歷史業務數據，可探討年度歸檔方案（將過舊年度之已結清發票移至備份庫保存），減輕線上查詢負荷。同時提供舊資料查詢的替代途徑。
  * 定期重組/重建索引以維持資料庫查詢效能，更新統計資料統計資訊(statistics)讓查詢最佳化器保持準確。

* \*\*安全維運：\*\*制定安全相關維運措施：

  * 定期審視使用者存取權限，移除不需要的帳號或調整角色，確保最小權限原則（Least Privilege）。重要角色操作（如管理員變更權限）應有雙人複核機制。
  * 定期更新伺服器系統與第三方套件的安全Patch，防範已知漏洞（可利用維護窗口實施）。
  * 監控異常登入行為，例如同一帳號短時間多次密碼錯誤、非預期時段的大量操作，若偵測則及時通知管理員並採取措施（如強制重設密碼、暫停帳號）。

* \*\*系統文件與知識庫：\*\*維運過程中，維護完整的系統文件方便知識傳承：

  * 系統規格書應隨系統演進即時更新（例如有新功能則補充相應章節），供新進人員快速了解系統。
  * 維運手冊記錄日常操作指引（如備份還原步驟、緊急聯絡人名單）。
  * 常見問題(FAQ)與使用者操作指南提供給終端使用者，減少重複支援成本。
  * 將歷次故障與解決方案彙整成知識庫，方便未來快速排除類似問題。

藉由上述維運規劃，團隊能主動監測並快速回應問題，確保系統**長期穩定可靠**地服務業務運作。良好的備援和監控機制也將把平行運作結束後的切換風險降到最低，建立使用單位對新系統的信心。

## 12. 系統時程與版本控管策略

本章提供專案時程規劃以及版本管理策略，讓團隊了解專案進度里程碑和軟體版本發佈的管理方式。透過明確的排程與版本控管，確保專案在預定時間內交付並有條理地演進。

* \*\*專案時程規劃 (Timeline)：\*\*專案預計總期間約為 12 個月，分階段進行。主要里程碑如下：

  1. \*\*啟動與需求調查 (Month 1-2)：\*\*成立專案團隊，確認專案範圍。與財務業務部門開會，彙整舊系統功能清單及額外需求。產出需求規格報告。
  2. \*\*系統分析與設計 (Month 3-4)：\*\*繪製系統架構圖與資料模型(ERD)。完成本系統規格書撰寫並評審確認。設計UI原型與流程圖給使用者早期回饋。準備AS/400整合方案技術實驗。
  3. \*\*模組開發 (Month 5-8)：\*\*分批實作各模組功能：

     * Month5: 完成客戶主檔、基礎架構設置（框架code、DB Schema）；
     * Month6: 完成發票開立、查詢API及前端介面；
     * Month7: 完成收款處理、電子發票串接實作；
     * Month8: 完成報表產生模組與所有剩餘功能。期間持續進行單元測試與整合測試。
  4. \*\*測試與修正 (Month 9-10)：\*\*專門的系統測試階段。Month9 在測試環境進行全面的功能測試和性能測試，記錄並修復Bug。Month10 安排使用者驗收測試(UAT)，針對使用者反饋進行最後調整，完善使用者操作文件。
  5. \*\*平行運作與導入 (Month 11-12)：\*\*Month11 部署新系統至正式環境並開始與舊系統平行運行。監控平行期間系統表現，確保資料同步正常。Month12 評估切換時機，執行最終資料遷移和用戶切換培訓，正式上線新系統並終止舊系統服務。
  6. \*\*後續優化 (Post Go-Live)：\*\*上線後的1-2個月列為穩定運行觀察期，期間密切支援用戶並優化問題。同時規劃下一版本的功能改進清單。

  *甘特圖：*（此處可附上專案甘特圖或里程碑圖表，視覺化以上時程，標示主要任務起訖與里程碑節點。）

* \*\*版本控管策略：\*\*專案採用嚴謹的版本管理以掌控每次發佈內容，並方便在平行期間進行修正與改版：

  * \*版本定義：\*如前述，我們使用三位數語意化版本號 (Major.Minor.Patch)。在平行運作開始時發佈的版本為 **v1.0.0** (第一版正式版)。在平行運作期間，針對使用者回饋的小幅改善或Bug修正，可發行後續的 Patch 版（如v1.0.1, v1.0.2）。若新增較大功能（例如原計畫外的優化），則提升次版本號 (v1.1.0 等) 發佈。待平行運作結束、確認新系統全面取代舊系統後，可標記為 **v2.0.0** 以示階段性重要里程。
  * \*發佈週期：\*在平行運作的密集調整期，預計每兩週發佈一次小版本（Sprint Release），快速迭代解決問題和提升。平行結束後，轉為穩定期，版本發佈節奏可放緩至每季度或視業務需要。所有版本發佈都需經過完整測試流程和業務單位確認。
  * \*版本分支：\*版本控管與Git分支策略相結合（如前章所述）。開發人員日常在 develop 分支工作，主要發佈版本維護在 main 分支。當需要支援平行期間的緊急修正，會建立 hotfix 分支直接從 main 修改並很快地合回 main 發佈新Patch版本，同步合回 develop 確保後續版本也包含修正。
  * \*標籤與版本文件：\*每次發佈時在版本控制中打Tag註記版本號，並編寫**發行說明 (Release Notes)**。發行說明記錄該版本的新功能、改進項目、修正的問題清單，以及任何需要使用者注意的變更。平行期間內的版本說明著重於問題修正與使用者回饋調整，上線後的版本則記錄新功能演進。
  * \*版本回溯與比對：\*透過版本號和版本說明，團隊可快速對照當前運行版本與先前版本的差異。如在平行運作遇到差異比較需求，可以將v1.0.0與v1.0.X進行比對，了解哪些修正可能導致某些輸出不同，協助排查新舊系統差異。
  * \*配置版本：\*對於資料庫Schema和外部介接，也採用版本控管。例如資料庫變更以遷移碼控管 (Migration scripts) 編號管理，使每個軟體版本對應唯一的資料庫結構版本。AS/400那端如需程式配合修改，也制定版本號與新系統同步發布，避免不匹配。

* \*\*變更管理：\*\*在平行運作期間以及之後，每項系統變更都遵守變更管理流程：

  * 提出變更請求（包括新需求或問題修復），評估對系統與用戶的影響及所屬版本發佈時機。
  * 通過變更審核（由專案經理和相關利害關係人決定是否採納及排程）。
  * 列入開發待辦，按版本計畫實作、測試。
  * 在適當的版本發布，並在發行說明與使用者通知中說明變更內容。

* \*\*里程碑回顧與調整：\*\*專案將在各主要里程碑完成時召開回顧會議，檢討進度偏差與風險：

  * 若某階段任務延遲，及早調整後續時程（壓縮平行運行期或增加人力等）確保最終上線日期不受影響。
  * 定期更新專案甘特圖和進度報告，讓管理層透明掌握開發進展與問題。對外溝通時，使用里程碑和版本號作為溝通節點，如「v1.0測試中，上線日期維持不變」。

綜上，透過明確的**時程規劃**以及嚴格的**版本控管策略**，專案團隊能有序地推進開發並適應過程中的變化，確保在預期的時間內成功交付高品質的新應收帳款管理系統。上述章節可作為專案管理和技術團隊在執行過程中的指導依據，並作為後續文件撰寫的標準模板和核對清單。
